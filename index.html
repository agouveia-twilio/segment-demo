<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Segment Pizza Flow</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <script>
    !function(){var i="analytics",analytics=window[i]=window[i]||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","screen","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware","register"];analytics.factory=function(e){return function(){if(window[i].initialized)return window[i][e].apply(window[i],arguments);var n=Array.prototype.slice.call(arguments);if(["track","screen","alias","group","page","identify"].indexOf(e)>-1){var c=document.querySelector("link[rel='canonical']");n.push({__t:"bpc",c:c&&c.getAttribute("href")||void 0,p:location.pathname,u:location.href,s:location.search,t:document.title,r:document.referrer})}n.unshift(e);analytics.push(n);return analytics}};for(var n=0;n<analytics.methods.length;n++){var key=analytics.methods[n];analytics[key]=analytics.factory(key)}analytics.load=function(key,n){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.setAttribute("data-global-segment-analytics-key",i);t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r);analytics._loadOptions=n};analytics._writeKey="hB3eh4jC2L0Np9ScPVIqDIG9iIrDVu27";;analytics.SNIPPET_VERSION="5.2.0";
    analytics.load("hB3eh4jC2L0Np9ScPVIqDIG9iIrDVu27");
    analytics.page("Home");
    }}();
    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 320px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .logo-container {
            margin-bottom: 20px;
        }

        .logo {
            max-width: 200px;
            height: auto;
        }

        .pizza-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .pizza-item {
            width: 48%;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .pizza-item img {
            width: 100%;
            border-radius: 8px;
        }

        .pizza-item.selected {
            border: 2px solid #4CAF50;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
            transform: scale(1.05);
            border-radius: 5%;
        }

        button {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: #fff;
            font-size: 16px;
        }

        .btn-primary {
            background-color: #4CAF50;
        }

        .btn-secondary {
            background-color: #da1d40;
        }

        .btn-info {
            background-color: #2196F3;
        }

        .btn-warning {
            background-color: #ff9800;
        }

        .btn-cartAbandoned {
            background-color: #0885ce;
            position: fixed;
            bottom: 60px;
            right: 20px;
            width: auto;
            padding: 8px 12px;
        }

        .btn-reset {
            background-color: #323030;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: auto;
            padding: 8px 12px;
        }

        .hidden {
            display: none;
        }

        .toppings {
            text-align: left;
            margin: 10px 0;
        }

        .toppings label {
            display: block;
            margin-bottom: 5px;
        }

        .input-group {
            margin-bottom: 10px;
            margin-right: 15px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 4px;
            color: #555;
        }

        .input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        #quantityControls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        #quantityControls button {
            width: auto;
            padding: 6px 12px;
            font-size: 20px;
            color: #fff;
            background-color: #2196F3;
        }

        #quantityDisplay {
            min-width: 30px;
            font-size: 18px;
        }

        .summary-item {
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            background: #fafafa;
            text-align: left;
        }

        .summary-item button {
            background: #ff5252;
            padding: 2px 6px;
            /* smaller padding */
            font-size: 14px;
            /* smaller font size */
            float: right;
            margin-top: 0;
            line-height: 1;
            border-radius: 3px;
            border: none;
            cursor: pointer;
            color: white;
            height: 24px;
            width: 24px;
            text-align: center;
            box-sizing: border-box;
        }
    </style>
</head>

<body>
    <div id="pizzaContainer" class="container">
        <div class="logo-container">
            <img src="https://images.g2crowd.com/uploads/product/image/large_detail/large_detail_205c43a22cc9f5d110bca0feac5ef444/segment.png"
                alt="Segment" class="logo" width="200" height="40" />
        </div>
        <hr class="rounded" />
        <h2>Select your Pizza</h2>
        <div class="pizza-list">
            <!-- pizza items -->
            <div class="pizza-item" data-id="1" data-name="Pepperoni Pizza" data-price="7.00" data-base-price="7.00">
                <img src="pepperoni.webp" alt="Pepperoni" width="200" height="160" />
                <p>Pepperoni</p>
                <p class="price">$7.00</p>
            </div>
            <div class="pizza-item" data-id="2" data-name="Margherita Pizza" data-price="6.00" data-base-price="6.00">
                <img src="margherita.jpg" alt="Margherita" width="200" height="160" />
                <p>Margherita</p>
                <p class="price">$6.00</p>
            </div>
            <div class="pizza-item" data-id="3" data-name="Veggie Pizza" data-price="8.00" data-base-price="8.00">
                <img src="veggie.jpg" alt="Veggie" width="200" height="160" />
                <p>Veggie</p>
                <p class="price">$8.00</p>
            </div>
            <div class="pizza-item" data-id="4" data-name="BBQ Chicken Pizza" data-price="9.00" data-base-price="9.00">
                <img src="bbq_chicken.jpg" alt="BBQ Chicken" width="200" height="160" />
                <p>BBQ Chicken</p>
                <p class="price">$9.00</p>
            </div>
        </div>
        <button id="customizeBtn" class="btn-secondary hidden">Customize Pizza</button>
        <div id="toppingsGroup" class="toppings hidden">
            <h3>Choose Additional Toppings</h3>
            <label><input type="checkbox" value="extra_cheese" data-price="2.00" /> Extra Cheese (+$2.00)</label>
            <label><input type="checkbox" value="mushrooms" data-price="0.8" /> Mushrooms (+$0.80)</label>
            <label><input type="checkbox" value="olives" data-price="1.00" /> Olives (+$1.00)</label>
            <button id="saveToppingsBtn" class="btn-primary">Save Toppings</button>
        </div>
        <div id="quantityBlock" class="hidden">
            <div id="quantityControls">
                <h3 style="margin: 0; font-size: 16px;">Quantity</h3>
                <button id="decrementQty">âˆ’</button>
                <span id="quantityDisplay">1</span>
                <button id="incrementQty">+</button>
            </div>
        </div>
        <button id="addToCartBtn" class="btn-primary hidden">Add to Cart</button>
    </div>

    <div id="summaryContainer" class="container">
        <h2>Order Summary</h2>
        <hr class="rounded" />
        <div id="summaryList"></div>
        <p>Base Price: $<span id="summaryBase">0.00</span></p>
        <p>Toppings: $<span id="summaryToppings">0.00</span></p>
        <p>Quantity: <span id="summaryQty">0</span></p>
        <p>Total: $<span id="summaryTotal">0.00</span></p>
        <button id="proceedToDeliveryBtn" class="btn-secondary">Continue to Checkout</button>
    </div>

    <div id="loginContainer" class="hidden container">
        <h2>Delivery Information</h2>
        <hr class="rounded" />
        <div id="accountChoice">
            <button id="haveAccountBtn" class="btn-primary" style="width:48%; display:inline-block;">Sign in</button>
            <button id="createAccountBtn" class="btn-info" style="width:48%; display:inline-block;">Create
                Account</button>
        </div>
        <form id="accountForm" class="hidden">
            <h3 id="accountFormTitle">Create Account</h3>
            <div class="input-group" id="nameGroup"><label>Name:</label><input type="text" id="acctName" /></div>
            <div class="input-group"><label>Email:</label><input type="email" id="acctEmail" /></div>
            <div class="input-group" id="zipcodeGroup"><label>Zipcode:</label><input type="text" id="acctZip" /></div>
            <div class="input-group"><label>Password:</label><input type="password" id="accPswd" /></div>
            <button id="submitNewAccountBtn" class="btn-info hidden">Create Account</button>
            <button id="submitAccountBtn" class="btn-info hidden">Continue</button>
        </form>
        <button id="finishOrderBtn" class="btn-warning hidden">Create Order</button>
    </div>

    <button id="resetBtn" class="btn-reset">Reset Flow & User Properties</button>
    <button id="cartAbandoned" class="btn-cartAbandoned">Trigger Cart Abandoned Event</button>

    <script>
        let selected = {};
        let quantity = 1;
        let cart = [];

        const quantityDisplay = document.getElementById('quantityDisplay');

        document.querySelectorAll('.pizza-item').forEach(item => {
            item.addEventListener('click', () => {
                analytics.track("Product Clicked");
                document.querySelectorAll('.pizza-item').forEach(p => p.classList.remove('selected'));
                item.classList.add('selected');
                selected = {
                    id: item.dataset.id,
                    name: item.dataset.name,
                    price: item.dataset.price,
                    base_price: item.dataset.basePrice,
                    toppings: []
                };
                document.getElementById('customizeBtn').classList.remove('hidden');
                document.getElementById('toppingsGroup').classList.add('hidden');
                document.getElementById('addToCartBtn').classList.add('hidden');
                document.getElementById('quantityBlock').classList.add('hidden');
            });
        });

        document.getElementById('customizeBtn').addEventListener('click', () => {
            document.getElementById('toppingsGroup').classList.remove('hidden');
        });

        document.getElementById('saveToppingsBtn').addEventListener('click', () => {
            analytics.track("Product Viewed");
            const toppings = [];
            document.querySelectorAll('#toppingsGroup input[type="checkbox"]:checked').forEach(cb => {
                toppings.push({ name: cb.value, price: cb.dataset.price });
            });
            selected.toppings = toppings;
            document.getElementById('addToCartBtn').classList.remove('hidden');
            document.getElementById('quantityBlock').classList.remove('hidden');
        });

        document.getElementById('incrementQty').addEventListener('click', () => {
            quantity++;
            quantityDisplay.textContent = quantity;
        });

        document.getElementById('decrementQty').addEventListener('click', () => {
            if (quantity > 1) {
                quantity--;
                quantityDisplay.textContent = quantity;
            }
        });

        document.getElementById('addToCartBtn').addEventListener('click', () => {
            analytics.track("Product Added");
            selected.quantity = quantity;
            const toppingsTotal = (selected.toppings || []).reduce((sum, t) => sum + parseFloat(t.price), 0);
            const total_price = (parseFloat(selected.price) + toppingsTotal) * quantity;
            selected.total_price = total_price.toFixed(2);
            cart.push({ ...selected });
            updateSummary();
            resetFlow();
        });

        function updateSummary() {
            const summaryList = document.getElementById('summaryList');
            summaryList.innerHTML = '';

            let totalBase = 0;
            let totalToppings = 0;
            let totalQty = 0;
            let totalPrice = 0;

            cart.forEach((item, index) => {
                const base = parseFloat(item.base_price);
                const toppings = (item.toppings || []).reduce((sum, t) => sum + parseFloat(t.price), 0);
                const qty = parseInt(item.quantity);
                const itemTotal = (base + toppings) * qty;

                totalBase += base * qty;
                totalToppings += toppings * qty;
                totalQty += qty;
                totalPrice += itemTotal;

                const itemEl = document.createElement('div');
                itemEl.className = 'summary-item';
                itemEl.innerHTML = `
                    <strong>${item.name}</strong> (x${qty}) - $${itemTotal.toFixed(2)}
                    <button onclick="removeFromCart(${index})">X</button>
                    <p style="font-size: 14px; margin-top: 8px;">Toppings: ${item.toppings?.map(t => t.name).join(', ') || 'None'}</p>
                `;
                summaryList.appendChild(itemEl);
            });

            document.getElementById('summaryBase').textContent = totalBase.toFixed(2);
            document.getElementById('summaryToppings').textContent = totalToppings.toFixed(2);
            document.getElementById('summaryQty').textContent = totalQty;
            document.getElementById('summaryTotal').textContent = totalPrice.toFixed(2);
        }

        function removeFromCart(index) {
            analytics.track("Product Removed");
            cart.splice(index, 1);
            updateSummary();
        }

        function resetFlow(hard = false) {
            selected = {};
            quantity = 1;
            quantityDisplay.textContent = "1";
            document.getElementById("pizzaContainer").classList.remove("hidden");
            document.getElementById('customizeBtn').classList.add('hidden');
            document.getElementById('toppingsGroup').classList.add('hidden');
            document.getElementById('addToCartBtn').classList.add('hidden');
            document.getElementById('quantityBlock').classList.add('hidden');
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('accountChoice').classList.add('hidden');
            document.getElementById('accountForm').classList.add('hidden');
            document.getElementById('finishOrderBtn').classList.add('hidden');
            document.getElementById('submitNewAccountBtn').classList.add('hidden');
            document.getElementById('submitAccountBtn').classList.add('hidden');

            document.querySelectorAll('#toppingsGroup input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('acctEmail').value = '';
            document.getElementById('acctName').value = '';
            document.getElementById('acctZip').value = '';
            document.getElementById('accPswd').value = '';
            document.querySelectorAll('.pizza-item').forEach(item => item.classList.remove('selected'));

            if (hard) {
                cart = [];
                updateSummary();
            }
        }

        document.getElementById('resetBtn').addEventListener('click', () => {
            analytics.track("Order Cancelled")
            resetFlow(true);
        });

        document.getElementById('cartAbandoned').addEventListener('click', () => {
            analytics.track("Cart Abandoned")
        });

        document.getElementById('proceedToDeliveryBtn').addEventListener('click', () => {
            analytics.track("Checkout Started")
            document.getElementById("pizzaContainer").classList.add("hidden");
            document.getElementById("proceedToDeliveryBtn").classList.add("hidden");
            document.getElementById('loginContainer').classList.remove('hidden');
            document.getElementById('accountChoice').classList.remove('hidden');
        });

        document.getElementById('haveAccountBtn').addEventListener('click', () => {
            analytics.track("Checkout Step Viewed")
            document.getElementById('accountForm').classList.remove('hidden');
            document.getElementById('submitAccountBtn').classList.remove('hidden');
            document.getElementById('submitNewAccountBtn').classList.add('hidden');
            document.getElementById('nameGroup').classList.add('hidden');
            document.getElementById('zipcodeGroup').classList.add('hidden');
            document.getElementById('accountFormTitle').textContent = 'Sign In';
        });

        document.getElementById('createAccountBtn').addEventListener('click', () => {
            analytics.track("Checkout Step Viewed")
            document.getElementById('accountForm').classList.remove('hidden');
            document.getElementById('submitNewAccountBtn').classList.remove('hidden');
            document.getElementById('submitAccountBtn').classList.add('hidden');
            document.getElementById('nameGroup').classList.remove('hidden');
            document.getElementById('zipcodeGroup').classList.remove('hidden');
            document.getElementById('accountFormTitle').textContent = 'Create Account';
        });

        document.getElementById('submitNewAccountBtn').addEventListener('click', (e) => {
            analytics.track("Checkout Step Completed")
            e.preventDefault();
            selected.zipcode = document.getElementById('acctZip').value;
            document.getElementById('finishOrderBtn').classList.remove('hidden');
        });

        document.getElementById('submitAccountBtn').addEventListener('click', (e) => {
            analytics.track("Checkout Step Completed")
            e.preventDefault();
            selected.zipcode = "00000";
            document.getElementById('finishOrderBtn').classList.remove('hidden');
        });

        document.getElementById('finishOrderBtn').addEventListener('click', () => {
            analytics.track("Order Completed")
            const totalQty = cart.reduce((sum, i) => sum + parseInt(i.quantity), 0);
            const totalPrice = cart.reduce((sum, i) => sum + parseFloat(i.total_price), 0);
            alert(`Order Created! ${totalQty} pizzas - $${totalPrice.toFixed(2)}`);
            resetFlow(true);
        });
    </script>

</body>

</html>